
- name: install common software
  yum:
    name: "{{item}}"
  with_items:
  - rsync

- name: create common directory
  file: path="{{item}}" state=directory
  with_items:
  - /root/software
  - /etc/kubernetes
  - /etc/kubernetes/ssl


- name: add authorized key
  authorized_key:
    user: root
    state: present
    key: "{{ lookup('file', '~/.ssh/k8s_rsa.pub') }}"

- name: get k8s server bin
  get_url: 
    url: "{{item.url}}"
    dest: "{{item.dest}}" 
  with_items:
    - {url: 'http://longban-software.oss-cn-shenzhen.aliyuncs.com/kubernetes-server-linux-amd64.tar.gz', dest: '/root/software/'}

- name: put k8s server bin
  shell: |
    cd /root/software
    tar -xzvf kubernetes-server-linux-amd64.tar.gz
    cd kubernetes
    tar -xzvf  kubernetes-src.tar.gz
    cp -r server/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,kube-proxy,kubelet} /usr/local/bin/
  args:
    executable: /bin/bash

